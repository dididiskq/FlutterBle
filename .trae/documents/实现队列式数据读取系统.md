## Flutter 语言切换实现方案

### 概述

实现一个简单的中英文切换功能，包括语言管理器、文本本地化和UI组件更新机制。

### 核心组件

1. **语言管理器**：管理当前语言状态和切换逻辑
2. **本地化文本**：存储中英文对应的文本映射
3. **状态管理**：使用 ChangeNotifier 通知UI更新
4. **UI集成**：在设备控制页面实现切换按钮

### 实现步骤

#### 1. 创建语言管理器

创建 `language_manager.dart` 文件：

```dart
import 'package:flutter/foundation.dart';

/// 语言类型枚举
enum LanguageType {
  chinese,
  english,
}

/// 语言管理器
class LanguageManager with ChangeNotifier {
  static final LanguageManager _instance = LanguageManager._internal();
  factory LanguageManager() => _instance;
  LanguageManager._internal();

  /// 当前语言
  LanguageType _currentLanguage = LanguageType.chinese;
  LanguageType get currentLanguage => _currentLanguage;

  /// 切换语言
  void toggleLanguage() {
    _currentLanguage = _currentLanguage == LanguageType.chinese 
        ? LanguageType.english 
        : LanguageType.chinese;
    notifyListeners();
  }

  /// 获取文本
  String getText(String key) {
    return _languageMap[_currentLanguage][key] ?? key;
  }

  /// 语言映射表
  final Map<LanguageType, Map<String, String>> _languageMap = {
    LanguageType.chinese: {
      'changeLanguageButton': '切换为英文',
      'deviceControlTitle': '设备控制',
      // 其他中文文本
    },
    LanguageType.english: {
      'changeLanguageButton': 'change to Chinese',
      'deviceControlTitle': 'Device Control',
      // 其他英文文本
    },
  };
}
```

#### 2. 在设备控制页面集成

修改 `bms_control_page.dart`：

```dart
import 'package:flutter/material.dart';
import '../managers/language_manager.dart';

class BmsControlPage extends StatefulWidget {
  const BmsControlPage({Key? key}) : super(key: key);
  @override
  State<BmsControlPage> createState() => _BmsControlPageState();
}

class _BmsControlPageState extends State<BmsControlPage> {
  final LanguageManager _languageManager = LanguageManager();
  
  @override
  Widget build(BuildContext context) {
    return ChangeNotifierProvider.value(
      value: _languageManager,
      child: Consumer<LanguageManager>(
        builder: (context, langManager, child) {
          return Scaffold(
            appBar: AppBar(
              title: Text(langManager.getText('deviceControlTitle')),
            ),
            body: Column(
              children: [
                _buildControlButton(
                  langManager.getText('changeLanguageButton'),
                  () {
                    langManager.toggleLanguage();
                  },
                ),
                // 其他UI组件
              ],
            ),
          );
        },
      ),
    );
  }
  
  Widget _buildControlButton(String text, VoidCallback onPressed) {
    // 原有的按钮实现
  }
}
```

#### 3. 依赖添加

确保在 `pubspec.yaml` 中添加 provider 依赖：

```yaml
dependencies:
  flutter:
    sdk: flutter
  provider: ^6.1.1
```

### 实现效果

* 初始状态：中文，按钮显示 "切换为英文"

* 点击按钮：切换为英文，按钮显示 "change to Chinese"

* 再次点击：切换回中文，按钮显示 "切换为英文"

* 所有使用 `getText()` 方法的文本都会自动更新

### 扩展建议

1. 增加更多语言支持
2. 从JSON文件加载语言映射表
3. 实现语言持久化存储
4. 增加语言切换动画效果

### 测试步骤

1. 运行应用
2. 进入设备控制页面
3. 点击语言切换按钮
4. 验证按钮文本和页面标题是否切换
5. 再次点击，验证是否切换回原语言

